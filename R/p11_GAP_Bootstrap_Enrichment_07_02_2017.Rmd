---
title: "Machine Learning"
author: "DJL"
date: "02/10/2016"
output:
  html_document:
    toc: yes
    toc_float: yes
---

#Overview

**Aim**  
Create Machine learning models using GAP data. 


#Libraries
```{r load_libs, tidy=TRUE}
rm(list = ls())
dev.off()
library(plyr)
library(dplyr)
library(lubridate)
library(reshape)
library(tableone)
library(stargazer)
library(VennDiagram)

```

#Functions
```{r define functions, tidy=TRUE}
#venn Diagram function
plotVennDia <- function(a, ...) {
    grid.newpage()
    if (length(a) == 1) {
        out <- draw.single.venn(likes(a), ...)
    }
    if (length(a) == 2) {
        out <- draw.pairwise.venn(likes(a[1]), likes(a[2]), likes(a[1:2]), ...)
    }
    if (length(a) == 3) {
        out <- draw.triple.venn(likes(a[1]), likes(a[2]), likes(a[3]), likes(a[1:2]), 
            likes(a[2:3]), likes(a[c(1, 3)]), likes(a), ...)
    }
    if (length(a) == 4) {
        out <- draw.quad.venn(likes(a[1]), likes(a[2]), likes(a[3]), likes(a[4]), 
            likes(a[1:2]), likes(a[c(1, 3)]), likes(a[c(1, 4)]), likes(a[2:3]), 
            likes(a[c(2, 4)]), likes(a[3:4]), likes(a[1:3]), likes(a[c(1, 2, 
                4)]), likes(a[c(1, 3, 4)]), likes(a[2:4]), likes(a), ...)
    }
    if (!exists("out")) 
        out <- "Oops"
    return(out)
}

#Venn Diagram helper fun
likes <- function(animals) {
    ppl <- 
    names(ppl) <- c("p", "d", "c", "s", "l")
    for (i in 1:length(animals)) {
        ppl <- subset(ppl, ppl[animals[i]] == T)
    }
    nrow(ppl)
}


unique(glmnet_all_predictors$Variables)



glmnet_all_predictors[glmnet_all_predictors$Model == "1_Gx",2]%in%glmnet_all_predictors[glmnet_all_predictors$Model == "2_Gx_Scz",2]


```


#Directories
```{r Define directories}
top_dir<-getwd()
data_dir <-"./P0_Characterise/output/"
data_dir0 <-"./data/"
output_dir <-"./P11_glmnet_bootstrap/output/"
figs_dir <-"./P11_glmnet_bootstrap/figs/"


##### Set up #####
#project name defined
project_name = "glmnet_enrichment"
project_id = "p11_"

```

#  Load predictors
```{r Predictor lists}

#Load data
glmnet_all_predictors<-read.csv(paste(output_dir,"p11_glmnet_boot_glmnet_all_mod_predictors.csv",sep=""))

#change value 1 to PRS_0.1 needed for true false df for venn diagram. 
glmnet_all_predictors[2]<-replace(glmnet_all_predictors[2], glmnet_all_predictors[2]==1, "PRS_0.1")

#vector of model ids
modelID<-c("1_Gx","2_Gx_Scz","3_PRS","4_Demographics","5_PRS_Demo","6_Gx_PRS","7_Gx_Demo","8_Gx_Demo_PRS")

```



# Venn Diagram 
```{r Enrichment}

grid.newpage()
draw.triple.venn(area1 = 22, area2 = 20, area3 = 13, n12 = 11, n23 = 4, n13 = 5, 
    n123 = 1, category = c("Dog People", "Cat People", "Lizard People"), lty = "blank", 
    fill = c("skyblue", "pink1", "mediumorchid"))


plotVennDia(c("d", "c", "l"), category = c("Dog People", "Cat People", "Lizard People"), 
    lty = "blank", fill = c("skyblue", "pink1", "mediumorchid"))
```


# Enrichment final models. 
```{r Enrichment}

table(glmnet_all_predictors$Variables)

table(glmnet_all_predictors$Model)
 
glmnet_all_predictors[glmnet_all_predictors$Model == "1_Gx",2]%in%glmnet_all_predictors[glmnet_all_predictors$Model == "2_Gx_Scz",2]


#Make venn diagram of overlap. For Gx, Gx_scz, PRS, PRS_Gx?


#drop factors
allpredictors<- data.frame(lapply(glmnet_all_predictors, as.character), stringsAsFactors=F)

#Get unique predictors
allpredictorsUnique<-unique(allpredictors[2])




#loop to add false true for each
for (i in 1:length(modelID)){
  temp<-filter(glmnet_all_predictors, Model == modelID[i])[2]
  allpredictorsUnique[,modelID[i]]<-allpredictorsUnique[,1] %in% temp[,1]
}

rownames(allpredictorsUnique)<-allpredictorsUnique[,1]
allpredictorsUnique<-allpredictorsUnique[,c(2:9,1)]



#Enrichments Gx and Gx_scz and PRS.



```

